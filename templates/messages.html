<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ guild }}/{{ channel }}</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        .message {
            font-size: 18px;
            color: black;
            padding: 10px;
            border-bottom: 1px solid #ccc;
        }
        .username {
            color: grey;
            font-size: 18px;
            padding-right: 1.5em;
        }
    </style>
</head>

<script>
function getCookie(name) {
    const value = `; ${document.cookie}`;
    const parts = value.split(`; ${name}=`);
    if (parts.length === 2) return parts.pop().split(';').shift();

}
async function handle() {
    event.preventDefault(); // Prevent the default form submission behavior

    const message = document.getElementById("message").value;
    console.log(message)

    try {
        // Make a POST request to your /message/ endpoint
        const response = await fetch("https://coltons.sytes.net/message", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                token: getCookie("token"),
                guildID: "{{ guild }}",
                channelID: "{{ channel }}",
                content: message
            }),
        });

        // Parse the response from the server
        if (!response.ok) {
            console.log(`Not OK ${response.status}`)
            alert(`not OK ${response.status}`)
        }
    } catch (error) {
        console.log(`Err: ${error}`)
        alert("Error.")
    }
};
</script>

<a href="https://coltons.sytes.net/login_fe">Log in</a>
<a href="https://coltons.sytes.net/logout_fe">Log out</a>

<body>
    <form onsubmit="handle(event)">
        <label for="message">Message:</label>
        <input type="text" id="message" name="message" required></input>
        <br><br>
        <button type="submit">Send</button>
    </form>

    <h1>{{ guild }}/{{ channel }}</h1>

    {% for message in messages %}
        <div class="message">
            <span class="username">{{ message.username }}</span>
            <span>{{ message.content }}</span>
        </div>
    {% endfor %}
</body>
</html>
